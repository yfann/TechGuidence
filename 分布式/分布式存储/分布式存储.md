

# 分布式存储


## 实现
+ HDFS
    + 中心化
+ Ceph
    + 一套架构同时满足块，对象，文件存储
    + 去中心化



## 硬件
+ PCIe总线
+ NVMe协议
+ PCIe接口 
+ SSD
    + M.2
    + PCIe
    + SATA
        + 比较慢
## 存储类型
+ 块存储(block storage)
    + 原理：
        + 块存储将硬盘分割成固定大小的块（例如512字节、4KB或更大），并提供给主机系统以块为单位进行读写操作。这些块通常会被格式化成一个逻辑单元号（LUN），然后挂载到服务器操作系统上作为一个本地磁盘。
    + 存储协议：
        + iSCSI
        + FC
    + 特点与应用：
        + 块存储具有低延迟、高IOPS性能的特点，适合于对性能要求高的应用，如数据库、虚拟机和大型企业应用程序。每个主机可以独立地管理和控制分配给它的块。
    + 使用对象
        + 设备

+ 文件存储(file storage)
    + 原理：
        + 文件存储按照层次化的目录结构来组织和存储数据，用户通过文件路径（如Windows中的C:\folder\file.txt或Linux中的/home/user/file.txt）来访问和管理数据。
    + 存储协议：
        + NFS
    + 特点与应用：
        + 文件存储适用于共享文件和协作环境，它支持多用户同时访问同一份文件，常见于办公文档共享、媒体资产库和需要跨多个服务器共享文件的场合
    + 使用对象
        + 人

+ 对象存储(object storage)
    + 块存储读写快，不利于共享，文件存储读写慢，利于共享。
        + 对象存储介于块存储和文件存储之间。
        + 文件存储的树状结构以及路径访问方式虽然方便人类理解、记忆和访问，但计算机需要把路径进行分解，然后逐级向下查找，最后才能查找到需要的文件，对于应用程序来说既没必要，也很浪费性能
        + 块存储是排它的，服务器上的某个逻辑块被一台客户端挂载后，其它客户端就无法访问上面的数据了
    + 优势
        + 对象存储是于键值管理的方式，利于客户端直接定位并操作数据，非常简单易用。
            + restful api
        + 对象存储天然适合网络存储的场景，所以非常便于在网络上共享和传输。
        + 而且因为不像文件系统拥有目录结构，不用目录检索以及维护目录结构，在海量文件场景访问时性能和效率表现会更加优秀。
    + 使用对象
        + 其他程序
## 不同网络连接方式
+ DAS(Direct-Attached storage)
    + DAS是指将外置存储设备通过SCSI或FC接口直接连接到服务器上，存储设备是整个服务器结构的一部分。这种设备直接连接到计算机主板总线上，计算机将其识别为一个块设备，例如常见的硬盘，U盘等，这种设备无法做到多主机实现共享。
+ SAN（Storage Area network）
    + SAN 存储系统通过光纤通道（Fibre Channel）、iSCSI等网络协议提供块级存储服务，使得多台服务器能够共享存储资源，并如同访问本地磁盘那样高效地存取数据。它需要借助客户端和服务端的SCSI驱动，通过FC或TCP/IP协议封装SCSI报文通过网络进行传输。它实现的是块级别的共享，通常被识别为一个块设备，但是需要借助专门的锁管理软件才能实现多主机并发访问。
+ NAS（Network-Attached storage）
    +  NAS存储也通常被称为附加存储，顾名思义，就是存储设备通过标准的网络拓扑结构(例如以太网)添加到一群计算机上。NAS是文件级的存储方法。

## 分布式块存储网络协议
+ ISCIS
    + 当主机连接到存储时，在主机就可以看到一个磁盘，该磁盘与本地磁盘没有任何差别。

+ NVMe-of（NVMe over Fabrics）
    + NVMe协议不仅限于在服务器内部直接连接本地固态存储设备，它还具备网络传输的能力，使得存储解决方案可以跨越物理界限。
    + 允许在存储系统与服务器之间建立灵活的点对点连接，实现高效的数据传输。

+ RDMA（Remote Direct Memory Access
    + TCP 协议栈在接收/发送报文时，内核需要做多次上下文切换，每次切换需要耗费 5~10us 左右的时延，另外还需要至少三次的数据拷贝和依赖 CPU 进行协议封装，这导致仅仅协议栈处理就带来数十微秒的固定时延，使得在 AI 数据运算和SSD 分布式存储等微秒级系统中，协议栈时延成为最明显的瓶颈。 为了降低网络时延和 CPU 占用率，诞生了 RDMA 。
    + RDMA是一种绕过远程主机 OS kernel 访问其内存中数据的技术



## ref
+ [ClickHouse](https://clickhouse.com/docs/zh/)
+ [独家深度 | 一文看懂 ClickHouse vs Elasticsearch：谁更胜一筹？](https://segmentfault.com/a/1190000039919389)
+ [分布式存储（一）：分布式存储基础](https://zhuanlan.zhihu.com/p/686693198)