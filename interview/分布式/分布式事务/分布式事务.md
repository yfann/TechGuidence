#  分布式事务
+ 无法使用本地事务
+ 数据最终一致性

## 方案
+ 两阶段提交（Two-Phase Commit, 2PC）： 2PC 是一种经典的分布式事务协议，它涉及两个阶段：准备（Precommit）和提交（Commit）。虽然它能够保证数据的一致性，但在某些情况下，它可能会导致阻塞和单点故障问题。
    + 2PC/3PC: 依赖数据库，能很好提供强一致和强事务，延迟高,适合单体应用，不适合高并发和高性能要求

+ 补偿事务（Compensating Transactions）： 这是一种通过在系统中引入补偿操作来处理分布式事务的方法。当一个事务失败时，系统会执行一系列逆向操作来回滚之前的操作。

+ TCC（Try-Confirm-Cancel）： TCC 是一种将分布式事务拆分为三个阶段的方法。首先是尝试阶段，然后是确认阶段，最后是取消阶段。这种方法允许在各个阶段执行业务逻辑和数据校验。
    + 适用于执行时间确定且较短，实时性要求高，对数据一致性要求高，比如互联网金融交易，支付，财务。

+ Saga模式： Saga 是一种将大事务拆分为一系列小的本地事务的方法。每个小事务都有一个相应的补偿操作，用于处理失败情况。Saga 模式可以通过实现各种协调和协作方式来实现，如 Choreography（协同式）和 Orchestration（编排式）。
    + 不能保证隔离性，要在业务层控制并发,适用于业务场景事务并发操作同意资源较少的情况。Sago没有预提交动作,导致补偿动作比较麻烦。适用于补偿容易处理的场景

+ 分布式数据库： 一些分布式数据库系统，如Google Spanner、CockroachDB等，内置了分布式事务支持，可以处理跨多个节点的事务。

+ 消息队列事务： 在消息队列系统中，一些解决方案允许你通过将消息和事务绑定在一起来实现分布式事务。例如，Apache Kafka 提供了事务支持。
    + 本地消息表/MQ事务：适用于参与方支持幂等，对一致性要求不高，业务上能容忍数据不一致到人工检查的周期

+ 数据库XA协议： XA 是一种协议，用于在分布式环境中协调多个数据库的事务。它通常由事务管理器（Transaction Manager）和多个资源管理器（Resource Manager）组成。

+ 分布式事务中间件： 一些分布式事务中间件，如Seata、Hmily等，提供了用于处理分布式事务的工具和机制。
    + Seata
    + Hmily



## tips
+ 长事务

+ 保证至少执行一次
    + 重试+幂等

+ 阿里Seata

+ CAP
    + Partition tolerance
        + 遇到任何网络分区故障时，任然能对外提供满足一致性和可用性的服务
        + 舍弃了P,及时单体架构

+ Base
    + BA(Basic Available)
        + 一定时间内返回一个明确结果
    + S(Soft State)
        + 数据库可以有中间状态
    + E（Eventual Consistency）
        + 数据过一定时候一致

## ref
+ [万字长文漫谈分布式事务实现原理](https://zhuanlan.zhihu.com/p/648556608)
+ [分布式事务系列三：Saga](https://zhuanlan.zhihu.com/p/95852045)

+ [对比 7 种分布式事务方案，阿里的 Seata 真香！(原理+实战)](https://cloud.tencent.com/developer/article/1975104)