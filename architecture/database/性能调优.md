
## 数据库连接池耗尽
+ 未关闭连接：应用程序在使用完数据库连接后，没有正确地关闭连接。这会使连接保持在连接池中，不可用于其他请求，最终导致连接池耗尽。

+ 长时间的连接占用：某些操作可能需要较长时间才能完成，例如复杂的查询或事务。如果连接在执行这些操作期间一直被占用，其他请求无法获取到连接，从而导致连接池用尽。

+ 连接泄漏：如果应用程序中发生了异常，连接没有被正确地释放，就会发生连接泄漏。这些泄漏的连接将永远不会返回到连接池中，最终导致连接池耗尽。

+ 连接池配置不当：连接池的大小和配置可能不足以处理应用程序的负载。如果连接池的最大连接数设置得太低，它可能很容易耗尽。另外，连接池的配置参数如最小空闲连接数、连接超时等也需要根据应用程序的需求进行调整。

+ 突发流量：当应用程序遭遇到意外的高流量或大量并发请求时，连接池可能会快速用尽连接，特别是在配置不合理的情况下。

+ 数据库性能问题：数据库服务器的性能问题，如高负载、慢查询或死锁，可能导致连接池用尽，因为数据库无法及时释放连接。

<!-- 为了解决数据库连接池耗尽的问题，可以考虑以下几种方法： -->

+ 确保在使用完连接后及时关闭它们，使用try-with-resources或finally块确保连接被正确释放。

+ 使用连接池管理工具，例如Apache DBCP、HikariCP或C3P0，它们可以自动管理连接的创建和释放。

+ 调整连接池的配置参数，确保连接池大小足够满足应用程序的需求。

+ 实施连接超时和闲置连接回收策略，以防止连接被占用太长时间。

+ 监控数据库性能，确保数据库服务器能够处理应用程序的负载。

+ 编写健壮的错误处理代码，以应对异常情况，确保连接在任何情况下都能被正确释放。

<!-- 大并发耗尽数据库连接的优化 -->
+ 增加数据库连接数： 一种解决方案是增加数据库的连接池大小。这允许数据库同时处理更多的连接请求。但是要小心，不要设置过高的连接数，以避免资源耗尽。

+ 优化数据库查询： 通过优化数据库查询和索引，可以减少每个请求所需的数据库连接时间。确保数据库表使用了适当的索引，并且查询语句是高效的。

+ 使用缓存： 使用缓存来减轻数据库的负载。对于频繁访问但不经常变化的数据，可以将其缓存到内存中，以减少对数据库的请求。

+ 负载均衡： 如果您的应用程序运行在多台服务器上，考虑使用负载均衡来分发请求。这有助于将请求均匀地分散到不同的数据库连接上。

+ 限制并发请求： 考虑实施请求限制策略，例如排队请求或限制同时处理的并发请求数。这可以帮助减少数据库连接数的压力。

+ 数据库优化： 如果可能的话，升级数据库服务器硬件或优化数据库配置，以提高其性能和容量。

+ 使用连接池： 使用数据库连接池管理连接，以便在不需要连接时释放它们，并在需要时重新使用它们，从而减少连接的开销。

+ 异步处理： 考虑将某些请求异步处理，以减少连接的占用时间。例如，将一些长时间运行的任务移到后台异步处理。






## tips
+ 索引深度

## ref
+ [为什么MySQL单表不能超过2000万行](https://bbs.huaweicloud.com/blogs/399181?utm_source=zhihu&utm_medium=bbs-ex&utm_campaign=other&utm_content=content)
