
# 网络

+ 二层设备(L2)
    - 物理层+链路层
    - 只能识别mac地址
    - 网桥,交换机
    - 连接以太网(局域网)

+ 三层设备(L3)
    - 物理层，链路层，网络层
    - 能识别mac地址,ip地址
    - 路由器，三层交换机,ip网关

+ 四层交换(L4)
    + OSI中第四层为传输层
    + 传输层负责端对端通信
    + TCP,UDP
    + 可以建立连接
        + 通过firewall
            +  L4 connections from A to B, connections at L3, A to B and B to A, must be allowed.


+ 广播域（MAC全为1能传到的范围）
    + 广播帧会传播到网络中的每台电脑
    + ARP广播
    + DHCP广播
    + 广播帧不会被switch过滤,switch收到后会flooding
    + 路由器可隔离冲突域和广播域
    

+ 冲突域
    + 设备共享同一网段
    + 同网段两个以上设备同时通讯时可能冲突
    + 交换机可隔离网段
        + 每个端口为新的网段

+ VLAN(虚拟局域网)
    + 分割广播域
        + 二层交换机只能构建单一广播域
        + 路由器的网络接口(LAN)为单位分割


+ 内网IP
    + 内网通过IP Sharing访问Internet
    + 内网计算机可以向internet上的计算机发请求，internet上的计算机不能向内网计算机发请求
    + 内网IP一般: 10.X.X.X, 172.16.X.X-172.31.X.X, 192.168.X.X

+ 公网IP
    + 静态公网IP
    + 动态公网IP
        + 路由器连接方式为pppoe,则是动态公网IP

+ CIDR
    + 205.123.196.183/25
        + /后表示前多少位表示网络

+ DHCP(动态主机配置协议)
    + provide dynamic IP

+ multiplexing(多路传输)
    + 网络上不同会话片段交错进行的过程
    + segmentation(分割)
    
+ protocal stack(协议栈)
    + OSI模型(七层)

+ Protocol Data Unit(PDU)
    + 数据片在各层中的结构
    + Data(应用层PDU)
    + Segment(传输层PDU)
        + 包含源MAC和目的MAC
    + Packet(网络层PDU)
    + Frame(链路层PDU)
    + Bits(物理层PDU)

+ 访问网络资源需要两种地址
    + 网络层地址
        + IP
            + 发送到相应网络和主机
            + DNS
    + 数据链路层地址
        + MAC(网卡地址)
            + 同一网络中，数据链路帧从一个网络接口发到另一个网络接口
            + 以太网LAN和无线网LAN介质不同，分别有自己的链路协议
        + 发送方主机使用 地址解析协议ARP(Address Resolution Protocol)检查本地网络所有MAC
            + IP(ARP request)---->MAC(ARP response)
                + 同一个网络中
            + 发送方主机在整个LAN中发送ARP请求（广播）
                + LAN上的每个设备会检查 ARP请求，如果IP相同则会发ARP响应
                    + ARP响应包含ARP请求中IP地址相对于的MAC地址

+ ingress
    + frame通过特定端口进入设备

+ egress
    + frame通过特定端口离开设备

+ 路由器
    + 可以分割广播域，冲突域
    + LAN接口有限
    + 主要功能是网络间传输数据


## 网关

+ 协议转换
+ 默认网关
    + 同网络上的路由器IP地址
    + 跨网访问时经过网关
    + 连接本地网与公网

## 交换机

+ 分割冲突域,访问LAN，通过VLAN实现

+ 接收Frame并转发到目的地址

+ MAC地址表
    + 学习，记录端口与设备关系
    + switch port -> device MAC
    + 交换机互联，一个端口会对应多个MAC

+ 交换机学习原地址，基于目的地址转发
    + Frame进入switch后，switch把Frame的source MAC及ingress(进入端口)记录到MAC地址表
    + 转发Frame时在MAC地址表中比较目的MAC
        + 如果存在,则在对应的端口转发Frame
        + 如果没有,则flooding
            + 向除ingress端口外所有端口发送Frame

+ store and forward(存储转发)
    + 差错控制(frame check sequence,FCS)
    + 自动缓存
        + 支持不同速率以太网混合连接


+ cut-through(直通交换)
    + 快速帧转发
        + 读完header就可以转发，不必等待帧全部进入端口

+ Fragment Free(无水平转发)

+ SAT(source address table)
    + 按照Frame的目的MAC,转发到合适端口



## VLAN(virtual local area network)

+ 与位置无关的逻辑端口
    + 一个switch可以有多个VLAN
    + 不同switch上主机可以在同一个VLAN
+ 不同VLAN连接必须通过路由器
+ 独立的三层网络
+ 隔离广播域
+ SAT
    + 记录: VLAN端口->MAC地址

+ trunk
    + 连接switch
    + 传递VLAN信息
    + 实现同一VLAN不同switch的通信
    + VLAN trunk不属于特定VLAN,而是交换机与路由器间多个VLAN的通道
    + VLAN tag
        + VID
        + CFI

+ `show mac address table`
+ `show vlan`

## 路由器

+ 不同网络间传输报文

+ process
    1. 从Frame中解析出三层报文(移除Frame头尾)
    2. 查看目的IP，路由表中查找最佳路由
    3. 找到最佳路径后，三层报文重新封装为二层Frame,转发到输出端口
        + IP地址不变
        + 二层数据链路地址会改变

+ 路由表
    + 直连路径
    + 远端路径
    + 动态路由协议

+ 下一跳

+ 静态路由
    + 手动配置

+ 动态路由
    + 路由器直接通信，利用收到的信息更新路由表
+ `show ip route`

## private network(专用网络)
+ 规范
    + RFC 1918(IPV4)
    + RFC 4193(IPV6)
+ 专网IP无法直接连互联网
    + 需要使用NAT(Network Address Translator)或代理服务器(proxy server)
+ 与公网IP相比，私有IP免费，适合局域网使用
+ HTTP/2 for gRPC
    + long lived connection

## TCP

+ 可靠性

+ 数据流控

+ 滑动窗口确认机制
    + 将独立的字节当做流来处理
        + sequence number
        + 数据流分段,限制分段的字节数,确认发送的分段

## 网络性能

+ 大型广播域分段提高网络性能
    + 设备在广播域产生大量的广播以及多播帧时就会与数据流竞争带宽
            + ARP
            + DHCP
            + STP
    + 路由器分割广播域
    + 二层交换机创建VLAN减少广播域

## ref
+ [网络基本功系列](https://wizardforcel.gitbooks.io/network-basic/index.html)
    + [pdf](https://github.com/wnma3mz/Reading-Books/blob/master/%E7%BD%91%E7%BB%9C%E5%9F%BA%E6%9C%AC%E5%8A%9F%E7%B3%BB%E5%88%97.pdf)
+ [互联网协议入门（一）](https://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)
+ [CIDR（无类域间路由）是什么？](http://c.biancheng.net/view/6409.html)


+ [OSI 7层模型和TCP/IP 4层模型](https://zhuanlan.zhihu.com/p/32059190)
+ [二层、三层、四层交换机的区别！](https://cloud.tencent.com/developer/article/1496025)
+ [详解VMware虚拟机网络连接模式(NAT,Bridged,Host-only)](https://www.jb51.net/article/106498.htm)
+ [一文读懂 HTTP/2 特性](https://zhuanlan.zhihu.com/p/26559480)
+ [VLAN 基础知识](https://zhuanlan.zhihu.com/p/35616289)
+ [一文了解什么是4层负载均衡,NAT,DR,TUN](https://segmentfault.com/a/1190000023814368)

+ [NAT 穿透是如何工作的：技术原理及企业级实践](https://zhuanlan.zhihu.com/p/450235047)