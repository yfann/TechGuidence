## JWT（JSON Web Token）vs Opaque（不透明）

JWT令牌是一种基于JSON的开放标准（RFC 7519），用于在网络应用中传输声明。JWT令牌由三个部分组成：头部（Header）、载荷（Payload）和签名（Signature）。头部包含了令牌的类型和算法等信息，载荷包含了一些声明（例如用户身份、权限等），签名用于验证令牌的完整性和真实性。JWT令牌可以被编码成紧凑的字符串，易于在网络请求中传递。由于JWT令牌包含了所有必要的信息，它可以被验证和解析，而无需访问存储令牌的数据库或服务。这使得JWT令牌适用于分布式系统和无状态的身份验证场景。

Opaque令牌（也称为不透明令牌）则相对于JWT令牌而言，它并不包含用户声明等信息。Opaque令牌是一个唯一的令牌标识符，它通常用于与身份验证服务器进行交互，并在服务器端存储与之相关的信息。在验证身份时，客户端通过提交令牌标识符给身份验证服务器，服务器端则根据令牌标识符来验证令牌的有效性，并获取与之相关的用户信息。因为令牌本身不包含用户信息，所以它比JWT令牌更轻量级，适用于传统的基于会话的身份验证模式。

这里是它们之间的一些主要区别：

+ 内容：JWT令牌包含了用户声明等信息，而Opaque令牌仅包含一个令牌标识符。
+ 验证方式：JWT令牌通过签名验证令牌的完整性和真实性，而Opaque令牌需要将令牌标识符与服务器端存储的相关信息进行比对验证。
+ 存储方式：JWT令牌可以在客户端和服务器之间传递，不需要额外的存储，而Opaque令牌通常需要在服务器端存储与之相关的信息。
+ 扩展性：JWT令牌可以包含自定义的声明，用于扩展令牌的功能，而Opaque令牌相对固定，不提供扩展性。
+ 选择使用JWT令牌还是Opaque令牌取决于具体的应用需求和安全考虑。JWT令牌适用于无状态和分布式系统，而Opaque令牌适用于传统的基于会话的身份验证模式。


## JWT 签名机制
JWT令牌在验证时不需要访问存储令牌的数据库或服务的原因在于其使用了签名（Signature）机制。

当服务器颁发JWT令牌给客户端时，它会使用一个密钥（通常是对称密钥或非对称密钥对）对令牌进行签名。这个签名是基于令牌的头部（Header）和载荷（Payload）以及密钥生成的。客户端在接收到JWT令牌后，可以通过对令牌的签名进行验证来确保令牌的完整性和真实性。

验证过程如下：

客户端从请求中获取JWT令牌。
客户端使用相同的密钥和算法解析JWT令牌，提取头部和载荷信息。
客户端重新计算令牌的签名，使用相同的密钥和算法。
客户端将重新计算得到的签名与JWT令牌中的签名进行比较。
如果两个签名匹配，则说明JWT令牌是有效的，否则表示令牌可能已被篡改或伪造。
由于令牌的签名是使用密钥生成的，只有服务器端持有密钥，因此客户端无需访问存储令牌的数据库或服务就能够验证令牌的有效性。服务器端只需验证令牌的签名是否与预期一致即可确定令牌的真实性。

需要注意的是，由于签名使用的密钥必须保密，泄露密钥可能导致令牌被伪造。因此，在使用JWT令牌时，密钥的安全性至关重要，密钥的管理和保护应当得到严格的控制和审查。